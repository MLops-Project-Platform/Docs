"use strict";(self.webpackChunkmlops_documentation=self.webpackChunkmlops_documentation||[]).push([[1242],{6643:function(e,n,r){r.r(n),r.d(n,{assets:function(){return l},contentTitle:function(){return o},default:function(){return u},frontMatter:function(){return t},metadata:function(){return s},toc:function(){return c}});var s=JSON.parse('{"id":"tools/postgres","title":"PostgreSQL","description":"What is PostgreSQL?","source":"@site/docs/tools/postgres.md","sourceDirName":"tools","slug":"/tools/postgres","permalink":"/docs/tools/postgres","draft":false,"unlisted":false,"editUrl":"https://github.com/MLops-Project-Platform/documentation/tree/main/docs/tools/postgres.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Database Overview","permalink":"/docs/tools/db-overview"},"next":{"title":"MySQL","permalink":"/docs/tools/mysql"}}'),i=r(4848),a=r(8453);const t={sidebar_position:3},o="PostgreSQL",l={},c=[{value:"What is PostgreSQL?",id:"what-is-postgresql",level:2},{value:"Role in MLOps Platform",id:"role-in-mlops-platform",level:2},{value:"Database Schema",id:"database-schema",level:2},{value:"Key Tables",id:"key-tables",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"docker-compose Configuration",id:"docker-compose-configuration",level:3},{value:"Common Operations",id:"common-operations",level:2},{value:"Connect to Database",id:"connect-to-database",level:3},{value:"Useful Queries",id:"useful-queries",level:3},{value:"Backup and Recovery",id:"backup-and-recovery",level:2},{value:"Backup Database",id:"backup-database",level:3},{value:"Restore Database",id:"restore-database",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Indexing",id:"indexing",level:3},{value:"Query Optimization",id:"query-optimization",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Check Database Size",id:"check-database-size",level:3},{value:"Monitor Connections",id:"monitor-connections",level:3},{value:"Check Active Queries",id:"check-active-queries",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Connection Issues",id:"connection-issues",level:3},{value:"Disk Space Issues",id:"disk-space-issues",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"postgresql",children:"PostgreSQL"})}),"\n",(0,i.jsx)(n.h2,{id:"what-is-postgresql",children:"What is PostgreSQL?"}),"\n",(0,i.jsx)(n.p,{children:"PostgreSQL is a powerful, open-source relational database system that serves as the metadata backend for MLflow."}),"\n",(0,i.jsx)(n.h2,{id:"role-in-mlops-platform",children:"Role in MLOps Platform"}),"\n",(0,i.jsx)(n.p,{children:"PostgreSQL stores:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Experiment metadata"})," - Experiment names, descriptions, tags"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Run information"})," - Run IDs, start/end times, statuses"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metrics"})," - Training metrics with timestamps"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Parameters"})," - Hyperparameters used in runs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tags"})," - Custom tags for organizing runs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Model Registry"})," - Model names, versions, stages"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,i.jsx)(n.h3,{id:"key-tables",children:"Key Tables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Experiments\r\nexperiments\r\n\u251c\u2500\u2500 experiment_id (primary key)\r\n\u251c\u2500\u2500 name\r\n\u251c\u2500\u2500 artifact_location\r\n\u251c\u2500\u2500 lifecycle_stage\r\n\u2514\u2500\u2500 creation_time\r\n\r\n-- Runs\r\nruns\r\n\u251c\u2500\u2500 run_id (primary key)\r\n\u251c\u2500\u2500 experiment_id (foreign key)\r\n\u251c\u2500\u2500 user_id\r\n\u251c\u2500\u2500 status\r\n\u251c\u2500\u2500 start_time\r\n\u251c\u2500\u2500 end_time\r\n\u2514\u2500\u2500 artifact_uri\r\n\r\n-- Metrics\r\nmetrics\r\n\u251c\u2500\u2500 run_id (foreign key)\r\n\u251c\u2500\u2500 key\r\n\u251c\u2500\u2500 value\r\n\u251c\u2500\u2500 timestamp\r\n\u2514\u2500\u2500 step\r\n\r\n-- Parameters\r\nparams\r\n\u251c\u2500\u2500 run_id (foreign key)\r\n\u251c\u2500\u2500 key\r\n\u2514\u2500\u2500 value\r\n\r\n-- Models\r\nregistered_models\r\n\u251c\u2500\u2500 name (primary key)\r\n\u251c\u2500\u2500 description\r\n\u2514\u2500\u2500 creation_timestamp\r\n\r\nmodel_versions\r\n\u251c\u2500\u2500 name\r\n\u251c\u2500\u2500 version\r\n\u251c\u2500\u2500 stage (e.g., 'Staging', 'Production')\r\n\u251c\u2500\u2500 creation_timestamp\r\n\u2514\u2500\u2500 source\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Connection string\r\nMLFLOW_BACKEND_STORE_URI=postgresql://mlflow:password@postgres:5432/mlflow\r\n\r\n# Username for database\r\nPOSTGRES_USER=mlflow\r\n\r\n# Password (change in production!)\r\nPOSTGRES_PASSWORD=mlflow\r\n\r\n# Database name\r\nPOSTGRES_DB=mlflow\n"})}),"\n",(0,i.jsx)(n.h3,{id:"docker-compose-configuration",children:"docker-compose Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'postgres:\r\n  image: postgres:14\r\n  environment:\r\n    POSTGRES_USER: mlflow\r\n    POSTGRES_PASSWORD: mlflow\r\n    POSTGRES_DB: mlflow\r\n  ports:\r\n    - "5432:5432"\r\n  volumes:\r\n    - postgres_data:/var/lib/postgresql/data\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-operations",children:"Common Operations"}),"\n",(0,i.jsx)(n.h3,{id:"connect-to-database",children:"Connect to Database"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# From host machine\r\npsql -h localhost -U mlflow -d mlflow -W\r\n\r\n# From within container\r\ndocker compose exec postgres psql -U mlflow -d mlflow\n"})}),"\n",(0,i.jsx)(n.h3,{id:"useful-queries",children:"Useful Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Count experiments\r\nSELECT COUNT(*) FROM experiments;\r\n\r\n-- Count runs per experiment\r\nSELECT experiment_id, COUNT(*) as run_count\r\nFROM runs\r\nGROUP BY experiment_id;\r\n\r\n-- Get latest 10 runs\r\nSELECT run_id, status, start_time\r\nFROM runs\r\nORDER BY start_time DESC\r\nLIMIT 10;\r\n\r\n-- Find best accuracy\r\nSELECT runs.run_id, metrics.value\r\nFROM runs\r\nJOIN metrics ON runs.run_id = metrics.run_id\r\nWHERE metrics.key = 'accuracy'\r\nORDER BY metrics.value DESC\r\nLIMIT 5;\r\n\r\n-- List all models in production\r\nSELECT name, version\r\nFROM model_versions\r\nWHERE stage = 'Production';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"backup-and-recovery",children:"Backup and Recovery"}),"\n",(0,i.jsx)(n.h3,{id:"backup-database",children:"Backup Database"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Using pg_dump\r\ndocker compose exec postgres pg_dump -U mlflow mlflow > backup.sql\r\n\r\n# Using docker volume backup\r\ndocker run --rm -v mlops-postgres_postgres_data:/data \\\r\n  -v $(pwd):/backup \\\r\n  ubuntu tar czf /backup/postgres_backup.tar.gz /data\n"})}),"\n",(0,i.jsx)(n.h3,{id:"restore-database",children:"Restore Database"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# From SQL dump\r\npsql -U mlflow -d mlflow < backup.sql\r\n\r\n# From volume backup\r\ndocker volume rm mlops-postgres_postgres_data\r\ndocker run --rm -v mlops-postgres_postgres_data:/data \\\r\n  -v $(pwd):/backup \\\r\n  ubuntu tar xzf /backup/postgres_backup.tar.gz -C /\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,i.jsx)(n.h3,{id:"indexing",children:"Indexing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Add indexes for common queries\r\nCREATE INDEX idx_runs_experiment_id \r\n  ON runs(experiment_id);\r\n\r\nCREATE INDEX idx_metrics_run_id \r\n  ON metrics(run_id);\r\n\r\nCREATE INDEX idx_metrics_key_value \r\n  ON metrics(key, value);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"query-optimization",children:"Query Optimization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Use ANALYZE to optimize query planner\r\nANALYZE;\r\n\r\n-- Check index usage\r\nSELECT schemaname, tablename, indexname \r\nFROM pg_indexes \r\nWHERE schemaname = 'public';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,i.jsx)(n.h3,{id:"check-database-size",children:"Check Database Size"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT pg_size_pretty(pg_database_size('mlflow')) AS size;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"monitor-connections",children:"Monitor Connections"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT count(*) as total_connections \r\nFROM pg_stat_activity;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"check-active-queries",children:"Check Active Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT pid, usename, query, query_start \r\nFROM pg_stat_activity \r\nWHERE state = 'active';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"connection-issues",children:"Connection Issues"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check if PostgreSQL is running\r\ndocker compose ps postgres\r\n\r\n# Check logs\r\ndocker compose logs postgres\r\n\r\n# Test connection\r\ndocker compose exec postgres \\\r\n  pg_isready -h localhost -U mlflow\n"})}),"\n",(0,i.jsx)(n.h3,{id:"disk-space-issues",children:"Disk Space Issues"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check table sizes\r\nSELECT schemaname, tablename, \r\n  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename))\r\nFROM pg_tables \r\nWHERE schemaname = 'public'\r\nORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;\r\n\r\n# Vacuum and analyze\r\nVACUUM ANALYZE;\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/architecture/overview",children:"Architecture"})," for how PostgreSQL fits in the system."]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:function(e,n,r){r.d(n,{R:function(){return t},x:function(){return o}});var s=r(6540);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);