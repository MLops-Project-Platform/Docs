"use strict";(self.webpackChunkmlops_documentation=self.webpackChunkmlops_documentation||[]).push([[3723],{7803:function(n,e,r){r.r(e),r.d(e,{assets:function(){return a},contentTitle:function(){return o},default:function(){return u},frontMatter:function(){return l},metadata:function(){return t},toc:function(){return c}});var t=JSON.parse('{"id":"tools/cicd","title":"CI/CD Pipelines","description":"Overview","source":"@site/docs/tools/cicd.md","sourceDirName":"tools","slug":"/tools/cicd","permalink":"/docs/tools/cicd","draft":false,"unlisted":false,"editUrl":"https://github.com/MLops-Project-Platform/documentation/tree/main/docs/tools/cicd.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"Monitoring & Observability","permalink":"/docs/tools/monitoring"}}'),s=r(4848),i=r(8453);const l={sidebar_position:10},o="CI/CD Pipelines",a={},c=[{value:"Overview",id:"overview",level:2},{value:"CI/CD Pipeline Stages",id:"cicd-pipeline-stages",level:2},{value:"Stage 1: Build",id:"stage-1-build",level:3},{value:"Stage 2: Test",id:"stage-2-test",level:3},{value:"Stage 3: Deploy (Dev)",id:"stage-3-deploy-dev",level:3},{value:"Stage 4: Deploy (QA)",id:"stage-4-deploy-qa",level:3},{value:"Stage 5: Deploy (Production)",id:"stage-5-deploy-production",level:3},{value:"GitHub Actions",id:"github-actions",level:2},{value:"Workflow Structure",id:"workflow-structure",level:3},{value:"Model Training CI/CD",id:"model-training-cicd",level:3},{value:"GitLab CI/CD",id:"gitlab-cicd",level:2},{value:".gitlab-ci.yml Configuration",id:"gitlab-ciyml-configuration",level:3},{value:"Jenkins Pipeline",id:"jenkins-pipeline",level:2},{value:"Jenkinsfile",id:"jenkinsfile",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Pipeline Failures",id:"pipeline-failures",level:3},{value:"Deployment Issues",id:"deployment-issues",level:3},{value:"Further Reading",id:"further-reading",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"cicd-pipelines",children:"CI/CD Pipelines"})}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(e.p,{children:"CI/CD (Continuous Integration/Continuous Deployment) automates testing, building, and deploying of machine learning models and infrastructure."}),"\n",(0,s.jsx)(e.h2,{id:"cicd-pipeline-stages",children:"CI/CD Pipeline Stages"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Code Push \u2192 Build \u2192 Test \u2192 Deploy to Dev \u2192 Deploy to QA \u2192 Deploy to Prod\n"})}),"\n",(0,s.jsx)(e.h3,{id:"stage-1-build",children:"Stage 1: Build"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Compile code"}),"\n",(0,s.jsx)(e.li,{children:"Build Docker images"}),"\n",(0,s.jsx)(e.li,{children:"Run unit tests"}),"\n",(0,s.jsx)(e.li,{children:"Code quality checks"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"stage-2-test",children:"Stage 2: Test"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Integration tests"}),"\n",(0,s.jsx)(e.li,{children:"End-to-end tests"}),"\n",(0,s.jsx)(e.li,{children:"Performance tests"}),"\n",(0,s.jsx)(e.li,{children:"Security scanning"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"stage-3-deploy-dev",children:"Stage 3: Deploy (Dev)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Deploy to development environment"}),"\n",(0,s.jsx)(e.li,{children:"Run smoke tests"}),"\n",(0,s.jsx)(e.li,{children:"Log results to MLflow"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"stage-4-deploy-qa",children:"Stage 4: Deploy (QA)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Manual approval required"}),"\n",(0,s.jsx)(e.li,{children:"Deploy to staging environment"}),"\n",(0,s.jsx)(e.li,{children:"Run load tests"}),"\n",(0,s.jsx)(e.li,{children:"Validate performance"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"stage-5-deploy-production",children:"Stage 5: Deploy (Production)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Final approval gate"}),"\n",(0,s.jsx)(e.li,{children:"Deploy to production"}),"\n",(0,s.jsx)(e.li,{children:"Monitor for issues"}),"\n",(0,s.jsx)(e.li,{children:"Rollback plan ready"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,s.jsx)(e.h3,{id:"workflow-structure",children:"Workflow Structure"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:".github/workflows/mlops-pipeline.yaml:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"name: MLOps CI/CD Pipeline\r\n\r\non:\r\n  push:\r\n    branches: [main, qa, dev]\r\n  pull_request:\r\n    branches: [main, qa, dev]\r\n\r\nenv:\r\n  REGISTRY: ghcr.io\r\n  IMAGE_NAME: ${{ github.repository }}\r\n\r\njobs:\r\n  build:\r\n    runs-on: ubuntu-latest\r\n    outputs:\r\n      image-tag: ${{ steps.meta.outputs.tags }}\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Set up Python\r\n      uses: actions/setup-python@v4\r\n      with:\r\n        python-version: '3.10'\r\n    \r\n    - name: Install dependencies\r\n      run: |\r\n        pip install -r requirements.txt\r\n        pip install pytest pytest-cov pylint\r\n    \r\n    - name: Lint code\r\n      run: pylint src/\r\n    \r\n    - name: Run unit tests\r\n      run: pytest tests/ -v --cov=src\r\n    \r\n    - name: Upload coverage\r\n      uses: codecov/codecov-action@v3\r\n      with:\r\n        files: ./coverage.xml\r\n    \r\n    - name: Build Docker image\r\n      uses: docker/build-push-action@v4\r\n      with:\r\n        context: .\r\n        push: false\r\n        tags: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}\r\n        outputs: type=docker,dest=/tmp/image.tar\r\n    \r\n    - name: Load Docker image\r\n      run: docker load --input /tmp/image.tar\r\n\r\n  test:\r\n    needs: build\r\n    runs-on: ubuntu-latest\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Run integration tests\r\n      run: |\r\n        docker-compose -f docker-compose.test.yml up --abort-on-container-exit\r\n    \r\n    - name: Run security scan\r\n      run: |\r\n        pip install bandit\r\n        bandit -r src/\r\n\r\n  deploy-dev:\r\n    needs: [build, test]\r\n    if: github.ref == 'refs/heads/dev'\r\n    runs-on: ubuntu-latest\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Deploy to Dev\r\n      run: |\r\n        kubectl apply -f k8s/dev/ --kubeconfig=${{ secrets.KUBECONFIG_DEV }}\r\n    \r\n    - name: Wait for deployment\r\n      run: |\r\n        kubectl rollout status deployment/mlops-platform -n mlops-dev\r\n\r\n  deploy-qa:\r\n    needs: [build, test]\r\n    if: github.ref == 'refs/heads/qa'\r\n    runs-on: ubuntu-latest\r\n    environment:\r\n      name: staging\r\n      url: https://qa.mlops.company.com\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Deploy to QA\r\n      run: |\r\n        kubectl apply -f k8s/qa/ --kubeconfig=${{ secrets.KUBECONFIG_QA }}\r\n    \r\n    - name: Run smoke tests\r\n      run: |\r\n        pytest tests/smoke/ -v\r\n    \r\n    - name: Notify deployment\r\n      uses: 8398a7/action-slack@v3\r\n      with:\r\n        status: ${{ job.status }}\r\n        text: 'QA deployment complete'\r\n        webhook_url: ${{ secrets.SLACK_WEBHOOK }}\r\n\r\n  deploy-prod:\r\n    needs: [build, test]\r\n    if: github.ref == 'refs/heads/main'\r\n    runs-on: ubuntu-latest\r\n    environment:\r\n      name: production\r\n      url: https://mlops.company.com\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Deploy to Production\r\n      run: |\r\n        kubectl apply -f k8s/prod/ --kubeconfig=${{ secrets.KUBECONFIG_PROD }}\r\n    \r\n    - name: Health check\r\n      run: |\r\n        curl -f https://mlops.company.com/health || exit 1\r\n    \r\n    - name: Notify team\r\n      uses: 8398a7/action-slack@v3\r\n      with:\r\n        status: ${{ job.status }}\r\n        text: 'Production deployment complete: ${{ github.sha }}'\r\n        webhook_url: ${{ secrets.SLACK_WEBHOOK }}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"model-training-cicd",children:"Model Training CI/CD"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:".github/workflows/model-training.yaml:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"name: Model Training Pipeline\r\n\r\non:\r\n  workflow_dispatch:\r\n    inputs:\r\n      config:\r\n        description: 'Training config file'\r\n        required: true\r\n        default: 'configs/default.yaml'\r\n      environment:\r\n        description: 'Deployment environment'\r\n        required: true\r\n        type: choice\r\n        options:\r\n          - dev\r\n          - qa\r\n          - prod\r\n\r\njobs:\r\n  train:\r\n    runs-on: ubuntu-latest\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Set up Python\r\n      uses: actions/setup-python@v4\r\n      with:\r\n        python-version: '3.10'\r\n    \r\n    - name: Install dependencies\r\n      run: pip install -r requirements.txt\r\n    \r\n    - name: Validate config\r\n      run: python scripts/validate_config.py ${{ github.event.inputs.config }}\r\n    \r\n    - name: Start training job\r\n      env:\r\n        MLFLOW_TRACKING_URI: ${{ secrets.MLFLOW_URI }}\r\n        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}\r\n        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\r\n      run: |\r\n        python src/train.py \\\r\n          --config ${{ github.event.inputs.config }} \\\r\n          --environment ${{ github.event.inputs.environment }}\r\n    \r\n    - name: Check model performance\r\n      run: python scripts/check_performance.py\r\n    \r\n    - name: Register model\r\n      if: success()\r\n      run: python scripts/register_model.py ${{ github.event.inputs.environment }}\r\n    \r\n    - name: Send notification\r\n      uses: 8398a7/action-slack@v3\r\n      with:\r\n        status: ${{ job.status }}\r\n        text: 'Training completed for ${{ github.event.inputs.config }}'\r\n        webhook_url: ${{ secrets.SLACK_WEBHOOK }}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"gitlab-cicd",children:"GitLab CI/CD"}),"\n",(0,s.jsx)(e.h3,{id:"gitlab-ciyml-configuration",children:".gitlab-ci.yml Configuration"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"stages:\r\n  - build\r\n  - test\r\n  - deploy-dev\r\n  - deploy-qa\r\n  - deploy-prod\r\n\r\nvariables:\r\n  REGISTRY: gitlab.com\r\n  IMAGE_NAME: $CI_PROJECT_NAME\r\n  IMAGE_TAG: $CI_COMMIT_SHA\r\n\r\nbuild:\r\n  stage: build\r\n  image: docker:latest\r\n  services:\r\n    - docker:dind\r\n  script:\r\n    - docker build -t $REGISTRY/$CI_PROJECT_NAMESPACE/$IMAGE_NAME:$IMAGE_TAG .\r\n    - docker push $REGISTRY/$CI_PROJECT_NAMESPACE/$IMAGE_NAME:$IMAGE_TAG\r\n  only:\r\n    - dev\r\n    - qa\r\n    - main\r\n\r\ntest:\r\n  stage: test\r\n  image: python:3.10\r\n  script:\r\n    - pip install -r requirements.txt\r\n    - pip install pytest pytest-cov\r\n    - pytest tests/ -v --cov=src\r\n  coverage: '/TOTAL.*\\s+(\\d+%)$/'\r\n  artifacts:\r\n    reports:\r\n      coverage_report:\r\n        coverage_format: cobertura\r\n        path: coverage.xml\r\n\r\ndeploy_dev:\r\n  stage: deploy-dev\r\n  image: bitnami/kubectl:latest\r\n  script:\r\n    - kubectl apply -f k8s/dev/ --kubeconfig=$KUBE_CONFIG_DEV\r\n    - kubectl rollout status deployment/mlops-platform -n mlops-dev\r\n  only:\r\n    - dev\r\n  environment:\r\n    name: development\r\n    kubernetes:\r\n      namespace: mlops-dev\r\n\r\ndeploy_qa:\r\n  stage: deploy-qa\r\n  image: bitnami/kubectl:latest\r\n  script:\r\n    - kubectl apply -f k8s/qa/ --kubeconfig=$KUBE_CONFIG_QA\r\n    - kubectl rollout status deployment/mlops-platform -n mlops-qa\r\n  only:\r\n    - qa\r\n  environment:\r\n    name: staging\r\n    kubernetes:\r\n      namespace: mlops-qa\r\n  when: manual\r\n\r\ndeploy_prod:\r\n  stage: deploy-prod\r\n  image: bitnami/kubectl:latest\r\n  script:\r\n    - kubectl apply -f k8s/prod/ --kubeconfig=$KUBE_CONFIG_PROD\r\n    - kubectl rollout status deployment/mlops-platform -n mlops-prod\r\n  only:\r\n    - main\r\n  environment:\r\n    name: production\r\n    kubernetes:\r\n      namespace: mlops-prod\r\n  when: manual\n"})}),"\n",(0,s.jsx)(e.h2,{id:"jenkins-pipeline",children:"Jenkins Pipeline"}),"\n",(0,s.jsx)(e.h3,{id:"jenkinsfile",children:"Jenkinsfile"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-groovy",children:"pipeline {\r\n    agent any\r\n    \r\n    environment {\r\n        REGISTRY = 'docker.io'\r\n        IMAGE_NAME = 'mlops/platform'\r\n        IMAGE_TAG = \"${BUILD_NUMBER}\"\r\n    }\r\n    \r\n    stages {\r\n        stage('Checkout') {\r\n            steps {\r\n                checkout scm\r\n            }\r\n        }\r\n        \r\n        stage('Build') {\r\n            steps {\r\n                script {\r\n                    sh '''\r\n                        docker build -t ${REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} .\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n        \r\n        stage('Test') {\r\n            steps {\r\n                script {\r\n                    sh '''\r\n                        docker run --rm ${REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} pytest tests/\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n        \r\n        stage('Push Image') {\r\n            when {\r\n                branch 'dev'\r\n            }\r\n            steps {\r\n                script {\r\n                    sh '''\r\n                        docker push ${REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n        \r\n        stage('Deploy to Dev') {\r\n            when {\r\n                branch 'dev'\r\n            }\r\n            steps {\r\n                script {\r\n                    sh '''\r\n                        kubectl apply -f k8s/dev/ --kubeconfig=${KUBECONFIG_DEV}\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n        \r\n        stage('Deploy to QA') {\r\n            when {\r\n                branch 'qa'\r\n            }\r\n            input {\r\n                message \"Deploy to QA?\"\r\n                ok \"Deploy\"\r\n            }\r\n            steps {\r\n                script {\r\n                    sh '''\r\n                        kubectl apply -f k8s/qa/ --kubeconfig=${KUBECONFIG_QA}\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n        \r\n        stage('Deploy to Prod') {\r\n            when {\r\n                branch 'main'\r\n            }\r\n            input {\r\n                message \"Deploy to Production?\"\r\n                ok \"Deploy\"\r\n            }\r\n            steps {\r\n                script {\r\n                    sh '''\r\n                        kubectl apply -f k8s/prod/ --kubeconfig=${KUBECONFIG_PROD}\r\n                    '''\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    post {\r\n        always {\r\n            cleanWs()\r\n        }\r\n        success {\r\n            slackSend(\r\n                color: 'good',\r\n                message: \"Pipeline succeeded: ${env.JOB_NAME} ${env.BUILD_NUMBER}\"\r\n            )\r\n        }\r\n        failure {\r\n            slackSend(\r\n                color: 'danger',\r\n                message: \"Pipeline failed: ${env.JOB_NAME} ${env.BUILD_NUMBER}\"\r\n            )\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Automate everything"})," - Code compilation, testing, deployment"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Fast feedback"})," - Run tests in parallel"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Environment parity"})," - Dev, QA, Prod should be similar"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Approval gates"})," - Require review before production"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Rollback capability"})," - Always plan rollback"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Monitoring"})," - Alert on pipeline failures"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Secrets management"})," - Use vaults for credentials"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Audit trail"})," - Log all deployments"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(e.h3,{id:"pipeline-failures",children:"Pipeline Failures"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Check workflow logs\r\ngh workflow view <workflow-id> --log\r\n\r\n# Retry failed job\r\ngh run rerun <run-id>\r\n\r\n# View specific job logs\r\ngh run view <run-id> --log --json logs\n"})}),"\n",(0,s.jsx)(e.h3,{id:"deployment-issues",children:"Deployment Issues"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Check Kubernetes logs\r\nkubectl logs -f deployment/mlops-platform\r\n\r\n# Describe deployment\r\nkubectl describe deployment mlops-platform\r\n\r\n# Check events\r\nkubectl get events --sort-by='.lastTimestamp'\n"})}),"\n",(0,s.jsx)(e.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.github.com/en/actions",children:"GitHub Actions Documentation"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.gitlab.com/ee/ci/",children:"GitLab CI/CD"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://www.jenkins.io/doc/",children:"Jenkins Documentation"})}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:function(n,e,r){r.d(e,{R:function(){return l},x:function(){return o}});var t=r(6540);const s={},i=t.createContext(s);function l(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);