"use strict";(self.webpackChunkmlops_documentation=self.webpackChunkmlops_documentation||[]).push([[304],{864:function(n,e,r){r.r(e),r.d(e,{assets:function(){return o},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return i},metadata:function(){return t},toc:function(){return c}});var t=JSON.parse('{"id":"deployment/production-setup","title":"Production Setup","description":"Complete production-ready deployment of the MLOps Platform.","source":"@site/docs/deployment/production-setup.md","sourceDirName":"deployment","slug":"/deployment/production-setup","permalink":"/docs/deployment/production-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/MLops-Project-Platform/documentation/tree/main/docs/deployment/production-setup.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3}}'),s=r(4848),a=r(8453);const i={sidebar_position:3},l="Production Setup",o={},c=[{value:"Pre-deployment Checklist",id:"pre-deployment-checklist",level:2},{value:"Infrastructure",id:"infrastructure",level:3},{value:"Security",id:"security",level:3},{value:"DNS &amp; SSL",id:"dns--ssl",level:3},{value:"Backups",id:"backups",level:3},{value:"Full Stack Deployment",id:"full-stack-deployment",level:2},{value:"1. Namespace and RBAC",id:"1-namespace-and-rbac",level:3},{value:"2. Secrets Management",id:"2-secrets-management",level:3},{value:"3. ConfigMaps",id:"3-configmaps",level:3},{value:"4. PostgreSQL StatefulSet (HA)",id:"4-postgresql-statefulset-ha",level:3},{value:"5. MinIO StatefulSet (HA)",id:"5-minio-statefulset-ha",level:3},{value:"6. MLflow Deployment (HA)",id:"6-mlflow-deployment-ha",level:3},{value:"7. Ingress with TLS",id:"7-ingress-with-tls",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Apply in Order",id:"apply-in-order",level:3},{value:"Verify",id:"verify",level:3},{value:"Monitoring and Alerting",id:"monitoring-and-alerting",level:2}];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"production-setup",children:"Production Setup"})}),"\n",(0,s.jsx)(e.p,{children:"Complete production-ready deployment of the MLOps Platform."}),"\n",(0,s.jsx)(e.h2,{id:"pre-deployment-checklist",children:"Pre-deployment Checklist"}),"\n",(0,s.jsx)(e.h3,{id:"infrastructure",children:"Infrastructure"}),"\n",(0,s.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Kubernetes cluster (HA setup with 3+ nodes)"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Storage class configured"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Ingress controller installed"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","TLS certificates ready"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Monitoring system (Prometheus/ELK)"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Logging system configured"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"security",children:"Security"}),"\n",(0,s.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Network policies configured"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","RBAC roles defined"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Secrets management (HashiCorp Vault/AWS Secrets Manager)"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Container registry authenticated"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Image scanning enabled"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"dns--ssl",children:"DNS & SSL"}),"\n",(0,s.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","DNS records configured"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","SSL certificates valid"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Certificate renewal automated"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Wildcard certificates if needed"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"backups",children:"Backups"}),"\n",(0,s.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Database backup strategy"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Artifact storage backup"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Configuration backups"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Disaster recovery plan"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"full-stack-deployment",children:"Full Stack Deployment"}),"\n",(0,s.jsx)(e.h3,{id:"1-namespace-and-rbac",children:"1. Namespace and RBAC"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"# production/01-namespace.yaml\r\napiVersion: v1\r\nkind: Namespace\r\nmetadata:\r\n  name: mlops-production\r\n  labels:\r\n    environment: production\r\n\r\n---\r\napiVersion: v1\r\nkind: ServiceAccount\r\nmetadata:\r\n  name: mlops-admin\r\n  namespace: mlops-production\r\n\r\n---\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: ClusterRoleBinding\r\nmetadata:\r\n  name: mlops-admin\r\nroleRef:\r\n  apiGroup: rbac.authorization.k8s.io\r\n  kind: ClusterRole\r\n  name: admin\r\nsubjects:\r\n- kind: ServiceAccount\r\n  name: mlops-admin\r\n  namespace: mlops-production\n"})}),"\n",(0,s.jsx)(e.h3,{id:"2-secrets-management",children:"2. Secrets Management"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# production/02-secrets.yaml\r\napiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: mlflow-db-credentials\r\n  namespace: mlops-production\r\ntype: Opaque\r\nstringData:\r\n  username: mlflow\r\n  password: "your-secure-password-here"\r\n  connection-string: "postgresql://mlflow:your-secure-password-here@postgres:5432/mlflow"\r\n\r\n---\r\napiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: minio-credentials\r\n  namespace: mlops-production\r\ntype: Opaque\r\nstringData:\r\n  access-key: "your-access-key"\r\n  secret-key: "your-secret-key"\r\n\r\n---\r\napiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: docker-registry-credentials\r\n  namespace: mlops-production\r\ntype: docker-registry\r\ndata:\r\n  .dockerconfigjson: # base64 encoded docker config\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-configmaps",children:"3. ConfigMaps"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"# production/03-configmaps.yaml\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: mlflow-config\r\n  namespace: mlops-production\r\ndata:\r\n  mlflow.conf: |\r\n    [mlflow]\r\n    tracking_uri = http://mlflow:5000\r\n    backend_store_uri = postgresql://mlflow@postgres:5432/mlflow\r\n    default_artifact_root = s3://mlflow-artifacts\r\n\r\n---\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: postgres-init\r\n  namespace: mlops-production\r\ndata:\r\n  init.sql: |\r\n    CREATE USER IF NOT EXISTS mlflow;\r\n    CREATE DATABASE IF NOT EXISTS mlflow;\r\n    GRANT ALL PRIVILEGES ON DATABASE mlflow TO mlflow;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"4-postgresql-statefulset-ha",children:"4. PostgreSQL StatefulSet (HA)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# production/04-postgres.yaml\r\napiVersion: apps/v1\r\nkind: StatefulSet\r\nmetadata:\r\n  name: postgres\r\n  namespace: mlops-production\r\nspec:\r\n  serviceName: postgres\r\n  replicas: 3\r\n  \r\n  selector:\r\n    matchLabels:\r\n      app: postgres\r\n  \r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: postgres\r\n    \r\n    spec:\r\n      affinity:\r\n        podAntiAffinity:\r\n          requiredDuringSchedulingIgnoredDuringExecution:\r\n          - labelSelector:\r\n              matchExpressions:\r\n              - key: app\r\n                operator: In\r\n                values:\r\n                - postgres\r\n            topologyKey: kubernetes.io/hostname\r\n      \r\n      containers:\r\n      - name: postgres\r\n        image: postgres:14-alpine\r\n        \r\n        ports:\r\n        - containerPort: 5432\r\n        \r\n        env:\r\n        - name: PGDATA\r\n          value: /var/lib/postgresql/data/pgdata\r\n        \r\n        - name: POSTGRES_USER\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: mlflow-db-credentials\r\n              key: username\r\n        \r\n        - name: POSTGRES_PASSWORD\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: mlflow-db-credentials\r\n              key: password\r\n        \r\n        - name: POSTGRES_DB\r\n          value: mlflow\r\n        \r\n        resources:\r\n          requests:\r\n            memory: "1Gi"\r\n            cpu: "500m"\r\n          limits:\r\n            memory: "2Gi"\r\n            cpu: "1000m"\r\n        \r\n        volumeMounts:\r\n        - name: data\r\n          mountPath: /var/lib/postgresql/data\r\n        \r\n        livenessProbe:\r\n          exec:\r\n            command:\r\n            - /bin/sh\r\n            - -c\r\n            - pg_isready -U mlflow\r\n          initialDelaySeconds: 30\r\n          periodSeconds: 10\r\n  \r\n  volumeClaimTemplates:\r\n  - metadata:\r\n      name: data\r\n    spec:\r\n      accessModes: [ "ReadWriteOnce" ]\r\n      resources:\r\n        requests:\r\n          storage: 100Gi\r\n\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: postgres\r\n  namespace: mlops-production\r\nspec:\r\n  clusterIP: None\r\n  selector:\r\n    app: postgres\r\n  ports:\r\n  - port: 5432\n'})}),"\n",(0,s.jsx)(e.h3,{id:"5-minio-statefulset-ha",children:"5. MinIO StatefulSet (HA)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# production/05-minio.yaml\r\napiVersion: apps/v1\r\nkind: StatefulSet\r\nmetadata:\r\n  name: minio\r\n  namespace: mlops-production\r\nspec:\r\n  serviceName: minio\r\n  replicas: 4\r\n  \r\n  selector:\r\n    matchLabels:\r\n      app: minio\r\n  \r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: minio\r\n    \r\n    spec:\r\n      affinity:\r\n        podAntiAffinity:\r\n          requiredDuringSchedulingIgnoredDuringExecution:\r\n          - labelSelector:\r\n              matchExpressions:\r\n              - key: app\r\n                operator: In\r\n                values:\r\n                - minio\r\n            topologyKey: kubernetes.io/hostname\r\n      \r\n      containers:\r\n      - name: minio\r\n        image: minio/minio:latest\r\n        \r\n        args:\r\n        - server\r\n        - http://minio-{0...3}.minio:9000/data\r\n        \r\n        ports:\r\n        - containerPort: 9000\r\n          name: api\r\n        - containerPort: 9001\r\n          name: console\r\n        \r\n        env:\r\n        - name: MINIO_ROOT_USER\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: minio-credentials\r\n              key: access-key\r\n        \r\n        - name: MINIO_ROOT_PASSWORD\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: minio-credentials\r\n              key: secret-key\r\n        \r\n        resources:\r\n          requests:\r\n            memory: "2Gi"\r\n            cpu: "1000m"\r\n          limits:\r\n            memory: "4Gi"\r\n            cpu: "2000m"\r\n        \r\n        volumeMounts:\r\n        - name: data\r\n          mountPath: /data\r\n        \r\n        livenessProbe:\r\n          httpGet:\r\n            path: /minio/health/live\r\n            port: api\r\n          initialDelaySeconds: 10\r\n          periodSeconds: 10\r\n  \r\n  volumeClaimTemplates:\r\n  - metadata:\r\n      name: data\r\n    spec:\r\n      accessModes: [ "ReadWriteOnce" ]\r\n      resources:\r\n        requests:\r\n          storage: 500Gi\r\n\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: minio\r\n  namespace: mlops-production\r\nspec:\r\n  clusterIP: None\r\n  selector:\r\n    app: minio\r\n  ports:\r\n  - port: 9000\r\n    name: api\r\n  - port: 9001\r\n    name: console\n'})}),"\n",(0,s.jsx)(e.h3,{id:"6-mlflow-deployment-ha",children:"6. MLflow Deployment (HA)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# production/06-mlflow.yaml\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: mlflow\r\n  namespace: mlops-production\r\nspec:\r\n  replicas: 3\r\n  \r\n  strategy:\r\n    type: RollingUpdate\r\n    rollingUpdate:\r\n      maxSurge: 1\r\n      maxUnavailable: 0\r\n  \r\n  selector:\r\n    matchLabels:\r\n      app: mlflow\r\n  \r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: mlflow\r\n      annotations:\r\n        prometheus.io/scrape: "true"\r\n        prometheus.io/port: "5000"\r\n    \r\n    spec:\r\n      affinity:\r\n        podAntiAffinity:\r\n          preferredDuringSchedulingIgnoredDuringExecution:\r\n          - weight: 100\r\n            podAffinityTerm:\r\n              labelSelector:\r\n                matchExpressions:\r\n                - key: app\r\n                  operator: In\r\n                  values:\r\n                  - mlflow\r\n              topologyKey: kubernetes.io/hostname\r\n      \r\n      containers:\r\n      - name: mlflow\r\n        image: ghcr.io/mlflow/mlflow:latest\r\n        \r\n        ports:\r\n        - containerPort: 5000\r\n        \r\n        env:\r\n        - name: MLFLOW_BACKEND_STORE_URI\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: mlflow-db-credentials\r\n              key: connection-string\r\n        \r\n        - name: MLFLOW_DEFAULT_ARTIFACT_ROOT\r\n          value: s3://mlflow-artifacts\r\n        \r\n        - name: AWS_ACCESS_KEY_ID\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: minio-credentials\r\n              key: access-key\r\n        \r\n        - name: AWS_SECRET_ACCESS_KEY\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: minio-credentials\r\n              key: secret-key\r\n        \r\n        - name: MLFLOW_S3_ENDPOINT_URL\r\n          value: http://minio:9000\r\n        \r\n        - name: AWS_S3_ALLOW_UNSAFE_RENAME\r\n          value: "true"\r\n        \r\n        command:\r\n        - mlflow\r\n        - server\r\n        - --backend-store-uri=$(MLFLOW_BACKEND_STORE_URI)\r\n        - --default-artifact-root=$(MLFLOW_DEFAULT_ARTIFACT_ROOT)\r\n        - --host=0.0.0.0\r\n        - --port=5000\r\n        \r\n        resources:\r\n          requests:\r\n            memory: "1Gi"\r\n            cpu: "500m"\r\n          limits:\r\n            memory: "2Gi"\r\n            cpu: "1000m"\r\n        \r\n        livenessProbe:\r\n          httpGet:\r\n            path: /health\r\n            port: 5000\r\n          initialDelaySeconds: 30\r\n          periodSeconds: 10\r\n        \r\n        readinessProbe:\r\n          httpGet:\r\n            path: /health\r\n            port: 5000\r\n          initialDelaySeconds: 10\r\n          periodSeconds: 5\r\n\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: mlflow\r\n  namespace: mlops-production\r\nspec:\r\n  type: LoadBalancer\r\n  selector:\r\n    app: mlflow\r\n  ports:\r\n  - port: 80\r\n    targetPort: 5000\r\n    name: http\n'})}),"\n",(0,s.jsx)(e.h3,{id:"7-ingress-with-tls",children:"7. Ingress with TLS"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# production/07-ingress.yaml\r\napiVersion: networking.k8s.io/v1\r\nkind: Ingress\r\nmetadata:\r\n  name: mlops-ingress\r\n  namespace: mlops-production\r\n  annotations:\r\n    cert-manager.io/cluster-issuer: letsencrypt-prod\r\n    nginx.ingress.kubernetes.io/rate-limit: "100"\r\n    nginx.ingress.kubernetes.io/ssl-redirect: "true"\r\nspec:\r\n  ingressClassName: nginx\r\n  \r\n  tls:\r\n  - hosts:\r\n    - mlflow.example.com\r\n    - docs.example.com\r\n    - minio.example.com\r\n    secretName: mlops-tls\r\n  \r\n  rules:\r\n  - host: mlflow.example.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: mlflow\r\n            port:\r\n              number: 80\r\n  \r\n  - host: docs.example.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: mlops-docs\r\n            port:\r\n              number: 3000\r\n  \r\n  - host: minio.example.com\r\n    http:\r\n      paths:\r\n      - path: /\r\n        pathType: Prefix\r\n        backend:\r\n          service:\r\n            name: minio\r\n            port:\r\n              number: 9001\n'})}),"\n",(0,s.jsx)(e.h2,{id:"deployment",children:"Deployment"}),"\n",(0,s.jsx)(e.h3,{id:"apply-in-order",children:"Apply in Order"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"cd production\r\n\r\nkubectl apply -f 01-namespace.yaml\r\nkubectl apply -f 02-secrets.yaml\r\nkubectl apply -f 03-configmaps.yaml\r\nkubectl apply -f 04-postgres.yaml\r\nkubectl apply -f 05-minio.yaml\r\n\r\n# Wait for postgres and minio to be ready\r\nkubectl wait --for=condition=Ready pod \\\r\n  -l app=postgres \\\r\n  -n mlops-production \\\r\n  --timeout=300s\r\n\r\n# Then deploy mlflow\r\nkubectl apply -f 06-mlflow.yaml\r\nkubectl apply -f 07-ingress.yaml\n"})}),"\n",(0,s.jsx)(e.h3,{id:"verify",children:"Verify"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Check all resources\r\nkubectl get all -n mlops-production\r\n\r\n# Check ingress\r\nkubectl get ingress -n mlops-production\r\n\r\n# View logs\r\nkubectl logs -f deployment/mlflow -n mlops-production\n"})}),"\n",(0,s.jsx)(e.h2,{id:"monitoring-and-alerting",children:"Monitoring and Alerting"}),"\n",(0,s.jsx)(e.p,{children:"Create monitoring stack monitoring for production health."}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.p,{children:["See ",(0,s.jsx)(e.a,{href:"/docs/tools/docker",children:"Container Management"})," and ",(0,s.jsx)(e.a,{href:"/docs/tools/kubernetes",children:"Kubernetes Guide"})," for more details."]})]})}function m(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(p,{...n})}):p(n)}},8453:function(n,e,r){r.d(e,{R:function(){return i},x:function(){return l}});var t=r(6540);const s={},a=t.createContext(s);function i(n){const e=t.useContext(a);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),t.createElement(a.Provider,{value:e},n.children)}}}]);