"use strict";(self.webpackChunkmlops_documentation=self.webpackChunkmlops_documentation||[]).push([[4764],{114:function(e,n,r){r.r(n),r.d(n,{assets:function(){return c},contentTitle:function(){return o},default:function(){return m},frontMatter:function(){return t},metadata:function(){return s},toc:function(){return l}});var s=JSON.parse('{"id":"tools/cassandra","title":"Apache Cassandra","description":"Overview","source":"@site/docs/tools/cassandra.md","sourceDirName":"tools","slug":"/tools/cassandra","permalink":"/docs/tools/cassandra","draft":false,"unlisted":false,"editUrl":"https://github.com/MLops-Project-Platform/documentation/tree/main/docs/tools/cassandra.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"MongoDB","permalink":"/docs/tools/mongodb"},"next":{"title":"Amazon DynamoDB","permalink":"/docs/tools/dynamodb"}}'),i=r(4848),a=r(8453);const t={sidebar_position:2},o="Apache Cassandra",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Use Cases in MLOps",id:"use-cases-in-mlops",level:2},{value:"Time-Series Training Metrics",id:"time-series-training-metrics",level:3},{value:"Installation",id:"installation",level:2},{value:"Docker Compose",id:"docker-compose",level:3},{value:"Data Modeling",id:"data-modeling",level:2},{value:"Partition Key Strategy",id:"partition-key-strategy",level:3},{value:"Denormalization for Performance",id:"denormalization-for-performance",level:3},{value:"Querying",id:"querying",level:2},{value:"Replication and Consistency",id:"replication-and-consistency",level:2},{value:"Configure Replication",id:"configure-replication",level:3},{value:"Consistency Levels",id:"consistency-levels",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Python Monitoring",id:"python-monitoring",level:3},{value:"Backup and Recovery",id:"backup-and-recovery",level:2},{value:"Incremental Backup",id:"incremental-backup",level:3},{value:"Performance Tuning",id:"performance-tuning",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"apache-cassandra",children:"Apache Cassandra"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Apache Cassandra is a distributed NoSQL database designed for high availability and scalability. It's excellent for time-series data and massive-scale deployments in MLOps systems."}),"\n",(0,i.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Distributed Architecture"})," - No single point of failure"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"High Availability"})," - Replication across multiple nodes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Linear Scalability"})," - Add nodes to increase capacity"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tunable Consistency"})," - Balance consistency and availability"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Columnar Storage"})," - Efficient compression and queries"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"use-cases-in-mlops",children:"Use Cases in MLOps"}),"\n",(0,i.jsx)(n.h3,{id:"time-series-training-metrics",children:"Time-Series Training Metrics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from cassandra.cluster import Cluster\r\nfrom cassandra import ConsistencyLevel\r\nfrom datetime import datetime\r\n\r\n# Connect to Cassandra\r\ncluster = Cluster(['127.0.0.1'])\r\nsession = cluster.connect('mlops')\r\n\r\n# Create keyspace\r\nsession.execute(\"\"\"\r\n    CREATE KEYSPACE IF NOT EXISTS mlops\r\n    WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 3}\r\n\"\"\")\r\n\r\n# Create metrics table\r\nsession.execute(\"\"\"\r\n    CREATE TABLE IF NOT EXISTS metrics (\r\n        experiment_id TEXT,\r\n        run_id TEXT,\r\n        timestamp TIMESTAMP,\r\n        metric_name TEXT,\r\n        metric_value FLOAT,\r\n        PRIMARY KEY ((experiment_id, run_id), timestamp, metric_name)\r\n    ) WITH CLUSTERING ORDER BY (timestamp DESC)\r\n\"\"\")\r\n\r\n# Insert metric\r\nsession.execute(\r\n    \"INSERT INTO metrics (experiment_id, run_id, timestamp, metric_name, metric_value) VALUES (%s, %s, %s, %s, %s)\",\r\n    ('exp_1', 'run_123', datetime.now(), 'accuracy', 0.95)\r\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\r\nservices:\r\n  cassandra:\r\n    image: cassandra:4.0\r\n    environment:\r\n      CASSANDRA_CLUSTER_NAME: "mlops-cluster"\r\n      CASSANDRA_NUM_TOKENS: 256\r\n      CASSANDRA_RPC_ADDRESS: 0.0.0.0\r\n    ports:\r\n      - "9042:9042"\r\n      - "9160:9160"\r\n    volumes:\r\n      - cassandra_data:/var/lib/cassandra\r\n    healthcheck:\r\n      test: ["CMD", "nodetool", "status"]\r\n      interval: 30s\r\n      timeout: 10s\r\n      retries: 5\r\n\r\nvolumes:\r\n  cassandra_data:\n'})}),"\n",(0,i.jsx)(n.h2,{id:"data-modeling",children:"Data Modeling"}),"\n",(0,i.jsx)(n.h3,{id:"partition-key-strategy",children:"Partition Key Strategy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Good: Data access pattern is clear (query by experiment)\r\nsession.execute("""\r\n    CREATE TABLE metrics_by_experiment (\r\n        experiment_id TEXT,\r\n        run_id TEXT,\r\n        timestamp TIMESTAMP,\r\n        accuracy FLOAT,\r\n        loss FLOAT,\r\n        PRIMARY KEY (experiment_id, run_id, timestamp)\r\n    )\r\n""")\r\n\r\n# Cluster key determines sort order\r\n# Results automatically sorted by (run_id, timestamp)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"denormalization-for-performance",children:"Denormalization for Performance"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Denormalize for single query access\r\nsession.execute("""\r\n    CREATE TABLE model_summary (\r\n        experiment_id TEXT,\r\n        run_id TEXT,\r\n        model_name TEXT,\r\n        accuracy FLOAT,\r\n        loss FLOAT,\r\n        created_at TIMESTAMP,\r\n        PRIMARY KEY (experiment_id, run_id)\r\n    )\r\n""")\r\n\r\n# Store both summary and detailed metrics\r\nsession.execute("""\r\n    INSERT INTO model_summary (experiment_id, run_id, model_name, accuracy, loss, created_at)\r\n    VALUES (%s, %s, %s, %s, %s, %s)\r\n    USING TIMESTAMP %s\r\n""", (\'exp_1\', \'run_123\', \'bert\', 0.95, 0.05, datetime.now(), int(datetime.now().timestamp() * 1000000)))\n'})}),"\n",(0,i.jsx)(n.h2,{id:"querying",children:"Querying"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from cassandra.query import SimpleStatement\r\n\r\n# Basic query\r\nquery = \"SELECT * FROM metrics WHERE experiment_id = %s\"\r\nrows = session.execute(query, ['exp_1'])\r\n\r\nfor row in rows:\r\n    print(f\"{row.timestamp}: {row.metric_name} = {row.metric_value}\")\r\n\r\n# Query with consistency level\r\nstatement = SimpleStatement(\r\n    \"SELECT * FROM metrics WHERE experiment_id = %s\",\r\n    consistency_level=ConsistencyLevel.LOCAL_QUORUM\r\n)\r\nrows = session.execute(statement, ['exp_1'])\r\n\r\n# Range queries\r\nquery = \"SELECT * FROM metrics WHERE experiment_id = %s AND run_id = %s AND timestamp > %s\"\r\nrows = session.execute(query, ['exp_1', 'run_123', datetime(2024, 1, 1)])\n"})}),"\n",(0,i.jsx)(n.h2,{id:"replication-and-consistency",children:"Replication and Consistency"}),"\n",(0,i.jsx)(n.h3,{id:"configure-replication",children:"Configure Replication"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Create keyspace with replication\r\nsession.execute(\"\"\"\r\n    CREATE KEYSPACE IF NOT EXISTS mlops\r\n    WITH replication = {\r\n        'class': 'NetworkTopologyStrategy',\r\n        'dc1': 3,\r\n        'dc2': 2\r\n    }\r\n\"\"\")\r\n\r\n# Verify replication\r\nresult = session.execute(\"DESCRIBE KEYSPACE mlops\")\n"})}),"\n",(0,i.jsx)(n.h3,{id:"consistency-levels",children:"Consistency Levels"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from cassandra import ConsistencyLevel\r\n\r\n# Strong consistency\r\nwrite_statement = SimpleStatement(\r\n    "INSERT INTO metrics ...",\r\n    consistency_level=ConsistencyLevel.ALL  # Wait for all replicas\r\n)\r\n\r\n# Eventual consistency  \r\nread_statement = SimpleStatement(\r\n    "SELECT * FROM metrics ...",\r\n    consistency_level=ConsistencyLevel.ONE  # Return first replica\r\n)\r\n\r\n# Balanced approach\r\nbalanced = SimpleStatement(\r\n    query,\r\n    consistency_level=ConsistencyLevel.LOCAL_QUORUM\r\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check node status\r\nnodetool status\r\n\r\n# View cluster info\r\nnodetool info\r\n\r\n# Compaction stats\r\nnodetool compactionstats\r\n\r\n# Disk usage\r\nnodetool diskusage\r\n\r\n# Repair (maintain consistency)\r\nnodetool repair mlops\n"})}),"\n",(0,i.jsx)(n.h3,{id:"python-monitoring",children:"Python Monitoring"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from cassandra.cluster import Cluster\r\nfrom cassandra.policies import DCAwareRoundRobinPolicy\r\n\r\ncluster = Cluster(\r\n    ['node1', 'node2', 'node3'],\r\n    load_balancing_policy=DCAwareRoundRobinPolicy(local_dc='dc1')\r\n)\r\n\r\n# Check cluster health\r\ndef check_cluster_health(cluster):\r\n    metadata = cluster.metadata\r\n    print(f\"Cluster name: {metadata.cluster_name}\")\r\n    print(f\"Partitioner: {metadata.partitioner}\")\r\n    \r\n    for host in metadata.all_hosts():\r\n        print(f\"Host {host.address}: {host.status}\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"backup-and-recovery",children:"Backup and Recovery"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Snapshot backup\r\nnodetool snapshot -t $(date +%s) mlops\r\n\r\n# Backup configuration\r\ncd /var/lib/cassandra/data/mlops/metrics-*/snapshots\r\ntar -czf /backups/metrics_snapshot.tar.gz\r\n\r\n# Restore from snapshot\r\nnodetool clearsnapshots\r\n# Copy snapshot files back\r\n# Run repair\r\nnodetool repair mlops\n"})}),"\n",(0,i.jsx)(n.h3,{id:"incremental-backup",children:"Incremental Backup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Enable commitlog backups\r\n# Edit cassandra.yaml: commitlog_sync: periodic\r\n\r\n# Backup commitlog\r\ncp /var/lib/cassandra/commitlog/* /backups/commitlog_backup/\r\n\r\n# Use backup tools (Cassandra-specific)\r\ncassandra-backup --backup-dir /backups\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from cassandra.cluster import Cluster, ExecutionProfile\r\nfrom cassandra.policies import TokenAwarePolicy, RoundRobinPolicy\r\n\r\n# Configure cluster for performance\r\ncluster = Cluster(\r\n    ['node1', 'node2', 'node3'],\r\n    load_balancing_policy=TokenAwarePolicy(RoundRobinPolicy())\r\n)\r\n\r\n# Use prepared statements\r\nprepared = session.prepare(\"\"\"\r\n    INSERT INTO metrics (experiment_id, run_id, timestamp, metric_name, metric_value)\r\n    VALUES (?, ?, ?, ?, ?)\r\n\"\"\")\r\n\r\n# Batch insert\r\nfrom cassandra.concurrent import execute_concurrent_with_args\r\n\r\nqueries = [\r\n    (prepared, ('exp_1', 'run_123', datetime.now(), 'accuracy', 0.95)),\r\n    (prepared, ('exp_1', 'run_123', datetime.now(), 'loss', 0.05)),\r\n]\r\n\r\nexecute_concurrent_with_args(session, queries)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Think in Queries"})," - Design schema based on how you'll query"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Denormalize"})," - Duplicate data for query performance"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Prepared Statements"})," - Reduce parsing overhead"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Batch Inserts"})," - Use batch API for multiple operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Monitor Compaction"})," - Keep disk space optimal"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tune Consistency"})," - Use appropriate consistency levels per use case"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check node status\r\nnodetool status\r\n\r\n# View logs\r\ntail -f /var/log/cassandra/system.log\r\n\r\n# Check Java heap\r\njps -l\r\n\r\n# Fix poor performance\r\nnodetool repair\r\nnodetool cleanup\r\nnodetool compact\n"})}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://cassandra.apache.org/doc/",children:"Cassandra Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.datastax.com/developers/data-modeling-best-practices",children:"Cassandra Data Modeling"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/datastax/python-driver",children:"Python Driver"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:function(e,n,r){r.d(n,{R:function(){return t},x:function(){return o}});var s=r(6540);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);